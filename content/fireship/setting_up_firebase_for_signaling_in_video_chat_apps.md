---
title: Setting up Firebase for signaling in video chat apps
videoId: WmR9IMUD_CY
---

From: [[fireship]] <br/> 

[[Building a peertopeer video chat app | WebRTC]] allows for the direct exchange of audio and video media streams between two or more browsers in a peer-to-peer connection, eliminating the need for a third-party server or native app for the media itself <a class="yt-timestamp" data-t="00:00:17">[00:00:17]</a>. However, a process called "signaling" is required for peers to securely exchange connection data, such as Session Description Protocol (SDP) objects and Interactive Connectivity Establishment (ICE) candidates <a class="yt-timestamp" data-t="00:00:51">[00:00:51]</a>. This signaling is handled by a third-party signaling server <a class="yt-timestamp" data-t="00:00:53">[00:00:53]</a>.

## Why Use Firebase for Signaling?

[[Introduction to Firebase and benefits | Firebase]] is an excellent choice for a signaling server because it simplifies the process of listening to real-time database updates <a class="yt-timestamp" data-t="00:04:05">[00:04:05]</a>. If using a traditional database, you would likely need to implement features like websockets to achieve similar real-time functionality <a class="yt-timestamp" data-t="00:04:11">[00:04:11]</a>. For developing a peer-to-peer video calling application from scratch, [[Firestore features and methods for handling chat data | Firebase's Firestore]] database can serve as the backend signaling server <a class="yt-timestamp" data-t="00:01:18">[00:01:18]</a>, <a class="yt-timestamp" data-t="00:04:00">[00:04:00]</a>.

## Setting up Firebase and Firestore

To begin, you need to [[setting_up_and_managing_firebase_projects | initialize Firebase and Firestore]]:
1.  From the [[setting_up_and_managing_firebase_projects | Firebase console]], initialize [[Firestore features and methods for handling chat data | Firestore]] in test mode <a class="yt-timestamp" data-t="00:04:21">[00:04:21]</a>.
2.  Create a web project from the settings panel and retrieve your project credentials <a class="yt-timestamp" data-t="00:04:23">[00:04:23]</a>.
3.  In your `main.js` file (for a vanilla JavaScript project), import Firebase and initialize the app with your configuration <a class="yt-timestamp" data-t="00:04:30">[00:04:30]</a>.

## Firestore Data Model for Signaling

For signaling, the following data model is used in [[Firestore features and methods for handling chat data | Firestore]]:
*   **Call Document**: A primary document used to manage the offer and answer details from both users <a class="yt-timestamp" data-t="00:07:05">[00:07:05]</a>. When creating a call, [[Firestore features and methods for handling chat data | Firebase]] can automatically generate a unique ID for this document, which can then be shared with another user <a class="yt-timestamp" data-t="00:07:18">[00:07:18]</a>.
*   **Offer Candidates Sub-collection**: A sub-collection under the call document that contains all the ICE candidates generated by the caller <a class="yt-timestamp" data-t="00:03:12">[00:03:12]</a>, <a class="yt-timestamp" data-t="00:07:10">[00:07:10]</a>.
*   **Answer Candidates Sub-collection**: Another sub-collection under the call document for the ICE candidates generated by the answering user <a class="yt-timestamp" data-t="00:03:13">[00:03:13]</a>, <a class="yt-timestamp" data-t="00:07:10">[00:07:10]</a>.

This structure allows for real-time signaling between the two peers <a class="yt-timestamp" data-t="00:03:16">[00:03:16]</a>.

## Handling Call Offers with Firebase

When a user initiates a call, they "make an offer" <a class="yt-timestamp" data-t="00:06:59">[00:06:59]</a>. This process involves several steps with [[Firestore features and methods for handling chat data | Firebase]]:

1.  **Create Call Document**: A call document is created in [[Firestore features and methods for handling chat data | Firestore]] <a class="yt-timestamp" data-t="00:02:44">[00:02:44]</a>, <a class="yt-timestamp" data-t="00:07:05">[00:07:05]</a>. Its unique ID is displayed to the user, allowing another user to join the call <a class="yt-timestamp" data-t="00:02:55">[00:02:55]</a>, <a class="yt-timestamp" data-t="00:07:23">[00:07:23]</a>.
2.  **Generate and Save SDP Offer**:
    *   The `RTCPeerConnection.createOffer` method is awaited, returning an offer description <a class="yt-timestamp" data-t="00:07:39">[00:07:39]</a>.
    *   This offer description is set as the local description on the peer connection <a class="yt-timestamp" data-t="00:07:42">[00:07:42]</a>.
    *   The Session Description Protocol (SDP) value from this offer, which contains information about the video codec and other negotiation details <a class="yt-timestamp" data-t="00:08:03">[00:08:03]</a>, is converted to a plain JavaScript object and written to the call document in [[Firestore features and methods for handling chat data | Firestore]] using `callDocument.set()` <a class="yt-timestamp" data-t="00:07:53">[00:07:53]</a>.
3.  **Collect and Save ICE Candidates**:
    *   Setting the local description automatically triggers the generation of ICE candidates <a class="yt-timestamp" data-t="00:08:13">[00:08:13]</a>. An ICE candidate includes a potential IP address and port pair for establishing the peer-to-peer connection <a class="yt-timestamp" data-t="00:08:19">[00:08:19]</a>.
    *   An event listener is set up for the `onicecandidate` event on the peer connection *before* the offer is created <a class="yt-timestamp" data-t="00:08:26">[00:08:26]</a>, <a class="yt-timestamp" data-t="00:08:29">[00:08:29]</a>.
    *   When an ICE candidate event fires, the candidate data is written as JSON to the `offerCandidates` sub-collection under the call document <a class="yt-timestamp" data-t="00:08:34">[00:08:34]</a>, <a class="yt-timestamp" data-t="00:03:08">[00:03:08]</a>.
4.  **Listen for Answer and Remote ICE Candidates**:
    *   The caller must listen for the answer from the remote user <a class="yt-timestamp" data-t="00:08:47">[00:08:47]</a>. This is done by listening for changes to the call document in [[Firestore features and methods for handling chat data | Firestore]] using the `onSnapshot` method <a class="yt-timestamp" data-t="00:08:53">[00:08:53]</a>.
    *   If the peer connection doesn't have a current remote description and the incoming data contains an answer, that answer description is set on the local peer connection <a class="yt-timestamp" data-t="00:09:01">[00:09:01]</a>.
    *   The caller also listens for ICE candidates from the answering user by setting up a listener on the `answerCandidates` collection <a class="yt-timestamp" data-t="00:09:20">[00:09:20]</a>. When a new document is added to this collection (using `docChanges`), a new ICE candidate is created and added to the peer connection <a class="yt-timestamp" data-t="00:09:30">[00:09:30]</a>.

## Handling Call Answers with Firebase

When a user joins an existing call, they "answer the call" <a class="yt-timestamp" data-t="00:00:44">[00:00:44]</a>, <a class="yt-timestamp" data-t="00:09:51">[00:09:51]</a>. This process is similar to making an offer:

1.  **Reference Call Document**: The answering user uses the call ID provided by the caller to reference the same call document in [[Firestore features and methods for handling chat data | Firestore]] <a class="yt-timestamp" data-t="00:09:57">[00:09:57]</a>. References to the call document and the `answerCandidates` collection are created <a class="yt-timestamp" data-t="00:10:02">[00:10:02]</a>.
2.  **Collect and Save ICE Candidates**:
    *   Similar to the caller, an `onicecandidate` event listener is set on the peer connection <a class="yt-timestamp" data-t="00:10:07">[00:10:07]</a>.
    *   Whenever a new ICE candidate is generated, it's written to the `answerCandidates` collection <a class="yt-timestamp" data-t="00:10:10">[00:10:10]</a>.
3.  **Fetch Offer and Set Remote Description**:
    *   The call document data is fetched from the database, which contains the original offer data <a class="yt-timestamp" data-t="00:10:15">[00:10:15]</a>.
    *   This offer data is then used to set a remote description on the answering user's peer connection <a class="yt-timestamp" data-t="00:10:18">[00:10:18]</a>.
4.  **Generate and Save SDP Answer**:
    *   An answer is generated locally using the peer connection <a class="yt-timestamp" data-t="00:10:26">[00:10:26]</a>.
    *   This answer is set as the local description on the peer connection <a class="yt-timestamp" data-t="00:10:28">[00:10:28]</a>.
    *   The answer is then converted to a plain object and updated on the call document in [[Firestore features and methods for handling chat data | Firestore]] so the caller can receive it <a class="yt-timestamp" data-t="00:10:32">[00:10:32]</a>.
5.  **Listen for Offer ICE Candidates**:
    *   A listener is set up on the `offerCandidates` collection <a class="yt-timestamp" data-t="00:10:41">[00:10:41]</a>.
    *   When new ICE candidates are added to this collection, they are used to create local ICE candidates and add them to the answering user's peer connection <a class="yt-timestamp" data-t="00:10:44">[00:10:44]</a>.

Through these steps, [[Firestore features and methods for handling chat data | Firebase]] facilitates the complex signaling process, allowing [[building_a_peertopeer_video_chat_app | WebRTC]] to establish a direct peer-to-peer connection for real-time media streaming <a class="yt-timestamp" data-t="00:10:59">[00:10:59]</a>.