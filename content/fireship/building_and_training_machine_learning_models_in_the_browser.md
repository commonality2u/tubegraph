---
title: Building and training machine learning models in the browser
videoId: Y_XM3Bu-4yc
---

From: [[fireship]] <br/> 

The announcement of TensorFlow.js was highlighted as a significant development <a class="yt-timestamp" data-t="00:00:04">[00:00:04]</a>. This JavaScript library enables users to build, train, and make predictions from machine learning models directly within the browser <a class="yt-timestamp" data-t="00:00:07">[00:00:07]</a>. This technology opens up new possibilities to combine [[web_development_tools_and_browser_recommendations | web development]] with machine learning <a class="yt-timestamp" data-t="00:00:23">[00:00:23]</a>. An example application involves using TensorFlow.js with Angular to predict the numeric value of a hand-drawn digit image <a class="yt-timestamp" data-t="00:00:13">[00:00:13]</a>. Source code for projects can be found at angularfirebase.com <a class="yt-timestamp" data-t="00:00:30">[00:00:30]</a>.

## What is TensorFlow?

TensorFlow is primarily a library for performing mathematical computations <a class="yt-timestamp" data-t="00:00:37">[00:00:37]</a>. It is widely recognized for its capability in building deep neural networks that power impressive artificial intelligence technologies <a class="yt-timestamp" data-t="00:00:41">[00:00:41]</a>. For individuals without a background in machine learning, TensorFlow might initially be challenging to use <a class="yt-timestamp" data-t="00:00:50">[00:00:50]</a>.

## Learning Machine Learning

For those looking to gain expertise in machine learning, a balanced approach is recommended <a class="yt-timestamp" data-t="00:01:06">[00:01:06]</a>. This involves dedicating approximately half of one's time to traditional courses, such as those offered by Coursera or Google's Machine Learning Crash Course <a class="yt-timestamp" data-t="00:01:09">[00:01:09]</a>. The other half of the time should be spent applying learned concepts in data science competitions on Kaggle, which serves as a global hub for such competitions <a class="yt-timestamp" data-t="00:01:02">[00:01:02]</a>. Data science competitions can be very addictive <a class="yt-timestamp" data-t="00:01:21">[00:01:21]</a>.

## How Machine Learning Models Work (High-Level Overview)

A typical machine learning narrative begins with a dataset where each item has a label indicating what it is <a class="yt-timestamp" data-t="00:01:32">[00:01:32]</a>. For instance, the MNIST dataset consists of images of hand-drawn digits <a class="yt-timestamp" data-t="00:01:39">[00:01:39]</a>. While humans can easily recognize these digits <a class="yt-timestamp" data-t="00:01:46">[00:01:46]</a>, to a computer, each image is merely a matrix of values without inherent context or meaning <a class="yt-timestamp" data-t="00:01:49">[00:01:49]</a>.

An image recognition convolutional neural network analyzes numerous samples of these images to extract features that differentiate one digit from another <a class="yt-timestamp" data-t="00:01:58">[00:01:58]</a>. The algorithm initially starts with random parameters and gradually corrects itself by processing more and more image samples <a class="yt-timestamp" data-t="00:02:10">[00:02:10]</a>.

## Building a Basic Linear Regression Model in the Browser

To demonstrate model building, training, and prediction in the browser, one can generate a new Angular application using the Angular CLI <a class="yt-timestamp" data-t="00:02:25">[00:02:25]</a>. After navigating into the app directory, TensorFlow.js can be installed <a class="yt-timestamp" data-t="00:02:30">[00:02:30]</a>.

### Model Setup

The most fundamental TensorFlow model is a linear regression <a class="yt-timestamp" data-t="00:02:35">[00:02:35]</a>. This involves feeding TensorFlow an array of values to predict another value, similar to using a person's height to roughly predict their weight <a class="yt-timestamp" data-t="00:02:40">[00:02:40]</a>. The machine learning model is trained when the Angular component is initialized <a class="yt-timestamp" data-t="00:02:51">[00:02:51]</a>, and predictions are run when a user enters a new value into a form field <a class="yt-timestamp" data-t="00:02:56">[00:02:56]</a>. Visually, a dataset might appear as blue dots representing samples, with a red line indicating the model generated by TensorFlow <a class="yt-timestamp" data-t="00:03:03">[00:03:03]</a>.

To implement this, TensorFlow is imported under the namespace `TF` in the Angular app component <a class="yt-timestamp" data-t="00:03:14">[00:03:14]</a>. A `linearModel` property is set up to define the TensorFlow model <a class="yt-timestamp" data-t="00:03:21">[00:03:21]</a>. The `sequential` API in TensorFlow.js is used, which is a higher-level, easier-to-use API similar to Keras in Python <a class="yt-timestamp" data-t="00:03:27">[00:03:27]</a>. An asynchronous function, `trainNewModel`, is created because TensorFlow.js works with Promises <a class="yt-timestamp" data-t="00:03:52">[00:03:52]</a>.

An empty model is defined by calling `TF.sequential()` <a class="yt-timestamp" data-t="00:04:00">[00:04:00]</a>. For linear regression, a `dense` (or fully connected) layer is added <a class="yt-timestamp" data-t="00:04:06">[00:04:06]</a>. This layer outputs a shape of one and takes an input with a shape of one <a class="yt-timestamp" data-t="00:04:10">[00:04:10]</a>. In a single-line linear regression, the `dense` layer simplifies to drawing a straight line through the data <a class="yt-timestamp" data-t="00:04:25">[00:04:25]</a>.

The `loss` metric is defined as Mean Squared Error (MSE), aiming to minimize the squared error of predictions <a class="yt-timestamp" data-t="00:04:29">[00:04:29]</a>. An `optimizer`, such as Stochastic Gradient Descent (SGD), determines how the model reaches the minimum error point <a class="yt-timestamp" data-t="00:04:40">[00:04:40]</a>.

### Tensors and Data

Data must be fed to the model in the form of a "tensor" <a class="yt-timestamp" data-t="00:04:57">[00:04:57]</a>. For practical purposes, a tensor can be thought of as an array <a class="yt-timestamp" data-t="00:05:04">[00:05:04]</a>. In machine learning, `X` represents the training features of the dataset <a class="yt-timestamp" data-t="00:05:22">[00:05:22]</a>, while `Y` is the label or the value the algorithm aims to predict <a class="yt-timestamp" data-t="00:05:29">[00:05:29]</a>.

### Training and Prediction

The model is trained by calling `linearModel.fit()` with the `X` and `Y` data <a class="yt-timestamp" data-t="00:05:44">[00:05:44]</a>. Training time varies with dataset size, but for a few values, it's very quick <a class="yt-timestamp" data-t="00:05:39">[00:05:39]</a>. The outcome is a statistical model capable of predicting values based on the provided dataset <a class="yt-timestamp" data-t="00:05:52">[00:05:52]</a>.

To make a prediction, `linearModel.predict()` is called, passing the input value as a tensor <a class="yt-timestamp" data-t="00:05:57">[00:05:57]</a>. The prediction is returned as a tensor, which then needs to be converted into a usable format for Angular <a class="yt-timestamp" data-t="00:06:05">[00:06:05]</a>. Since TensorFlow operations run within a session, `dataSync()` is called on the tensor to extract the data into an array <a class="yt-timestamp" data-t="00:06:10">[00:06:10]</a>.

The linear prediction method is executed whenever the form input value changes in the HTML <a class="yt-timestamp" data-t="00:06:21">[00:06:21]</a>. When running the app in the browser, entering smaller numbers should result in decreased predictions, and larger numbers should result in increased predictions <a class="yt-timestamp" data-t="00:06:32">[00:06:32]</a>.

## More Complex Neural Networks: Image Recognition

Neural networks have significantly advanced image recognition <a class="yt-timestamp" data-t="00:06:42">[00:06:42]</a>. For tasks like predicting the value of a handwritten digit drawn on an HTML canvas <a class="yt-timestamp" data-t="00:06:47">[00:06:47]</a>, direct training in the browser is too CPU and memory intensive <a class="yt-timestamp" data-t="00:06:57">[00:06:57]</a>.

### [[transferring_machine_learning_models_from_python_to_tensorflowjs | Transferring Models from Python to TensorFlow.js]]

A key feature of TensorFlow.js is the ability to [[transferring_machine_learning_models_from_python_to_tensorflowjs | import models that have been trained in Python]] <a class="yt-timestamp" data-t="00:07:02">[00:07:02]</a>. This allows developers to build and train machine learning models on a local system and then upload them to a web application for user access <a class="yt-timestamp" data-t="00:07:09">[00:07:09]</a>.

Keras is a tool that allows for exporting trained models <a class="yt-timestamp" data-t="00:07:27">[00:07:27]</a>. TensorFlow provides a utility to convert Keras files into a format specifically usable by TensorFlow.js, which also shards the file for efficient web loading <a class="yt-timestamp" data-t="00:07:30">[00:07:30]</a>. This conversion tool is installed using the Python package manager `pip` <a class="yt-timestamp" data-t="00:07:39">[00:07:39]</a>. While the converted models can be stored in an Angular `assets` directory for development, cloud storage buckets are recommended for real-world applications <a class="yt-timestamp" data-t="00:07:54">[00:07:54]</a>.

### Loading and Predicting with Pre-trained Models

Once converted, a model can be loaded with a simple `tensorflow.loadModel()` call <a class="yt-timestamp" data-t="00:08:44">[00:08:44]</a>. The lower-level TensorFlow model API (`tf.Model`) is used here, which is generally more challenging for newcomers <a class="yt-timestamp" data-t="00:08:18">[00:08:18]</a>. Predictions will be an array of ten values, where each value represents the probability that a specific index (0-9) is the correct digit drawn on the canvas <a class="yt-timestamp" data-t="00:08:27">[00:08:27]</a>. The index with the highest probability is assumed to be the drawn number <a class="yt-timestamp" data-t="00:08:38">[00:08:38]</a>.

Memory management is crucial to avoid memory leaks in client-side applications when dealing with neural networks <a class="yt-timestamp" data-t="00:08:57">[00:08:57]</a>. This can be achieved by running prediction code within a `tensorflow.tidy()` method, which ensures all tensors are released from memory once the prediction is complete <a class="yt-timestamp" data-t="00:09:03">[00:09:03]</a>.

Image data from an HTML canvas is extracted as an `ImageData` type <a class="yt-timestamp" data-t="00:09:13">[00:09:13]</a>. TensorFlow.js can convert various image types into tensors <a class="yt-timestamp" data-t="00:09:21">[00:09:21]</a>. Since the demo model was trained with 28x28 pixel images with one color channel, the input data needs to be reshaped to `[1, 28, 28, 1]` (batch size, height, width, color channels) <a class="yt-timestamp" data-t="00:09:27">[00:09:27]</a>. Additionally, if the Python model used an integer data type, TensorFlow.js requires floating-point, so `tensorflow.cast()` is used to change the data type, as all data types within a tensor must be uniform <a class="yt-timestamp" data-t="00:09:49">[00:09:49]</a>.

With the data in the correct format, it's passed to the model for prediction <a class="yt-timestamp" data-t="00:10:03">[00:10:03]</a>. The prediction, returned as a tensor, is then converted to an array using `dataSync()` <a class="yt-timestamp" data-t="00:10:08">[00:10:08]</a>. The application can be set up to run this prediction method every time a new image is drawn on the canvas <a class="yt-timestamp" data-t="00:10:15">[00:10:15]</a>. The model demonstrated is about 90% accurate with typical handwriting <a class="yt-timestamp" data-t="00:10:21">[00:10:21]</a>.

## Visualizing Neural Networks

To visualize how neural networks function internally, the TensorFlow Playground is recommended <a class="yt-timestamp" data-t="00:10:30">[00:10:30]</a>. This tool, which served as an original inspiration for TensorFlow.js, illustrates how neural networks construct complex boundaries around datasets to make predictions <a class="yt-timestamp" data-t="00:10:36">[00:10:36]</a>.

For those interested in learning how to [[building_web_apps_with_various_programming_languages | build modern JavaScript apps]] for any platform, becoming a pro member at angularfirebase.com offers access to a large library of exclusive content and one-on-one project support <a class="yt-timestamp" data-t="00:10:51">[00:10:51]</a>.