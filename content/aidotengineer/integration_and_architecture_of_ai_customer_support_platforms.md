---
title: Integration and architecture of AI customer support platforms
videoId: sXXl3YMU7ZI
---

From: [[aidotengineer]] <br/> 

14.ai is developing an [[introduction_and_application_of_ai_in_business_platforms | AI native customer support platform]] designed to interact directly with end users <a class="yt-timestamp" data-t="00:00:05">[00:00:05]</a>. This platform relies on Large Language Models (LLMs) in production and must operate reliably under uncertain conditions <a class="yt-timestamp" data-t="00:00:09">[00:00:09]</a>.

## Core Technology: Effect

To manage the complexity of building robust, type-safe, and composable systems, 14.ai utilizes Effect, a TypeScript library <a class="yt-timestamp" data-t="00:00:16">[00:00:16]</a>. While TypeScript provides a strong foundation, it falls short when dealing with unreliable APIs, complex system dependencies, non-deterministic model outputs, or long-running workflows <a class="yt-timestamp" data-t="00:00:27">[00:00:27]</a>. Effect offers tools to confidently handle such situations as the platform evolves <a class="yt-timestamp" data-t="00:00:36">[00:00:36]</a>.

Key features of Effect include:
*   Strong type guarantees across the stack <a class="yt-timestamp" data-t="00:00:44">[00:00:44]</a>
*   Powerful composition primitives <a class="yt-timestamp" data-t="00:00:48">[00:00:48]</a>
*   Built-in concurrency, streaming, interruptions, and retry mechanisms <a class="yt-timestamp" data-t="00:00:50">[00:00:50]</a>
*   Structured error modeling <a class="yt-timestamp" data-t="00:00:54">[00:00:54]</a>
*   A clean dependency injection system for easier testing and modernization <a class="yt-timestamp" data-t="00:00:57">[00:00:57]</a>
*   Easy observability via OpenTelemetry <a class="yt-timestamp" data-t="00:01:02">[00:01:02]</a>

Effect aids in building stable, testable, and maintainable code at scale <a class="yt-timestamp" data-t="00:01:07">[00:01:07]</a>. It can be gradually adopted into an [[using_existing_enterprise_systems_for_ai_integration | existing codebase]] and feels like a natural extension of TypeScript <a class="yt-timestamp" data-t="00:01:14">[00:01:14]</a>.

## Platform Architecture

14.ai uses Effect across its entire stack <a class="yt-timestamp" data-t="00:01:23">[00:01:23]</a>. The main components are:
*   **React Front End** Powers dashboards, the agents' interface, knowledge management, insights, analytics, and SDKs <a class="yt-timestamp" data-t="00:01:28">[00:01:28]</a>.
*   **Internal RPC Server** Handles app logic, built on Effect RPC and a modified version of Tanstack Query on the front end <a class="yt-timestamp" data-t="00:01:37">[00:01:37]</a>.
*   **Public API Server** Uses Effect HTTP with autogenerated OpenAPI documentation from annotated schemas <a class="yt-timestamp" data-t="00:01:47">[00:01:47]</a>.
*   **Data Processing Engine** Syncs data from CRM, documents, and databases, processing it for real-time analytics and reporting <a class="yt-timestamp" data-t="00:01:53">[00:01:53]</a>.
*   **Agent Workflows** Written in a custom Domain Specific Language (DSL) built on Effect, allowing a mix of deterministic and non-deterministic behavior <a class="yt-timestamp" data-t="00:02:00">[00:02:00]</a>.
*   **PostgreSQL Database** Used for both data and vector storage, with Effect SQL handling queries <a class="yt-timestamp" data-t="00:02:09">[00:02:09]</a>.

Effect schemas are used throughout the system for runtime validation, encoding, decoding, type-safe input/output handling, and autogenerated documentation <a class="yt-timestamp" data-t="00:02:15">[00:02:15]</a>.

## Agent Design and Workflows

The AI agents function as planners: they receive user input, devise a plan, select the appropriate action, workflow, or sub-agent, execute it, and repeat until the task is complete <a class="yt-timestamp" data-t="00:02:28">[00:02:28]</a>.

*   **Actions** Small, focused units of execution, similar to tool calls (e.g., fetching payment info, searching logs) <a class="yt-timestamp" data-t="00:02:40">[00:02:40]</a>.
*   **Workflows** Deterministic multi-step processes (e.g., cancelling a subscription involving collecting a reason, offering retention, checking eligibility, and performing cancellation) <a class="yt-timestamp" data-t="00:02:51">[00:02:51]</a>.
*   **Sub-agents** Group related actions and workflows into larger, domain-specific modules (e.g., a billing agent or a log retrieval agent) <a class="yt-timestamp" data-t="00:03:03">[00:03:03]</a>.

To model this complexity, a domain-specific language for workflows was built using Effect's functional pipe-based system, enabling clear and composable expression of branching, sequencing, retries, state transitions, and memory <a class="yt-timestamp" data-t="00:03:14">[00:03:14]</a>.

## Ensuring Reliability

Given that these systems power mission-critical operations, reliability is paramount <a class="yt-timestamp" data-t="00:03:32">[00:03:32]</a>.
*   **LLM Provider Fallback** If one LLM provider fails, the system falls back to another with similar performance characteristics (e.g., GPT-4 Mini falling back to Gemini Flash 2.0 for tool calling) <a class="yt-timestamp" data-t="00:03:36">[00:03:36]</a>. This is modeled with retry policies that track state to avoid retrying failed providers <a class="yt-timestamp" data-t="00:03:47">[00:03:47]</a>.
*   **Token Stream Duplication** Answers are often streamed to the end user. Token streams are duplicated, sending one directly to the user and another for internal storage (e.g., for analytics) <a class="yt-timestamp" data-t="00:03:55">[00:03:55]</a>. Effect facilitates this process <a class="yt-timestamp" data-t="00:04:05">[00:04:05]</a>.
*   **Dependency Injection for Testing** Heavy use of dependency injection allows for mocking LLM providers and simulating failure scenarios. This approach enables swapping service providers with mock versions without affecting the system's internals <a class="yt-timestamp" data-t="00:04:08">[00:04:08]</a>.

## Developer Experience

Effect provides an excellent developer experience for building agentic systems <a class="yt-timestamp" data-t="00:04:25">[00:04:25]</a>.
*   **Schema-Centric Design** Input, output, and error types are defined upfront with powerful encoding/decoding built-in, providing strong type safety guarantees and automatic documentation <a class="yt-timestamp" data-t="00:04:32">[00:04:32]</a>.
*   **Dependency Injection** Services are provided at the system's entry point, enabling composability and easy mocking for testing <a class="yt-timestamp" data-t="00:04:48">[00:04:48]</a>. Dependencies are type-level, guaranteeing at compile time that all required services are provided <a class="yt-timestamp" data-t="00:04:59">[00:04:59]</a>.
*   **Modularity** Services are modular and composable, allowing easy overriding of behavior or swapping implementations without affecting system internals <a class="yt-timestamp" data-t="00:05:06">[00:05:06]</a>.
*   **Strong Guard Rails** Effect helps prevent common mistakes, allowing engineers new to TypeScript to become productive quickly <a class="yt-timestamp" data-t="00:05:14">[00:05:14]</a>.

## Lessons Learned and Adoption

While powerful, using Effect effectively requires discipline <a class="yt-timestamp" data-t="00:05:31">[00:05:31]</a>. It's easy to write clean code for the "happy path," but one must be careful not to accidentally catch errors upstream or silently lose important failures <a class="yt-timestamp" data-t="00:05:37">[00:05:37]</a>. Dependency injection can be challenging to grasp at scale, as tracing service provision across multiple layers or subsystems can be difficult <a class="yt-timestamp" data-t="00:05:55">[00:05:55]</a>.

Effect has a significant learning curve due to its extensive ecosystem of concepts and tools <a class="yt-timestamp" data-t="00:06:10">[00:06:10]</a>. However, once past the initial bump, the benefits compound <a class="yt-timestamp" data-t="00:06:17">[00:06:17]</a>.

Effect helps build predictable and resilient systems but is not magic; developers still need to think <a class="yt-timestamp" data-t="00:06:27">[00:06:27]</a>. A key advantage is its incremental adoption capability; one can start with a single service or endpoint and expand from there <a class="yt-timestamp" data-t="00:06:37">[00:06:37]</a>.

Effect is particularly useful for LLM and [[integration_of_ai_agents_into_existing_infrastructure | AI based systems]] where reliability and coping with non-determinism are crucial <a class="yt-timestamp" data-t="00:06:47">[00:06:47]</a>. It provides tools for predictable and observable systems <a class="yt-timestamp" data-t="00:06:53">[00:06:53]</a>. It brings the rigor of functional programming into real-world TypeScript in a practical way for production use, offering value even without being a functional programming purist <a class="yt-timestamp" data-t="00:06:58">[00:06:58]</a>.