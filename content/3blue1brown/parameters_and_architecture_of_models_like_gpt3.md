---
title: Parameters and architecture of models like GPT3
videoId: eMlx5fFNoYc
---

From: [[3blue1brown]] <br/> 

## Overview of [[Neural Networks and Transformers | Transformers]] in [[Large language models and prediction | Large Language Models]]
[[Neural Networks and Transformers | Transformers]] are a core technology within [[Large language models and prediction | large language models]] (LLMs) and other modern AI tools <a class="yt-timestamp" data-t="00:00:04">[00:00:04]</a>. First introduced in the 2017 paper "Attention is All You Need" <a class="yt-timestamp" data-t="00:00:10">[00:00:10]</a>, their primary goal in models like [[Generative Pretrained Transformers | GPT-3]] is to take text and predict the next word <a class="yt-timestamp" data-t="00:00:30">[00:00:30]</a>.

## Input Processing and Embeddings
Input text is broken down into "tokens," often words or pieces of words <a class="yt-timestamp" data-t="00:00:36">[00:00:36]</a>. Each token is initially associated with a [[Token embeddings and highdimensional vectors | high-dimensional vector]], known as its embedding <a class="yt-timestamp" data-t="00:00:51">[00:00:51]</a>. These embeddings encode both the word's meaning and its position within the text <a class="yt-timestamp" data-t="00:05:05">[00:05:05]</a>, <a class="yt-timestamp" data-t="00:05:07">[00:05:07]</a>. The transformer's objective is to progressively adjust these initial, context-free embeddings to bake in richer contextual meaning <a class="yt-timestamp" data-t="00:01:28">[00:01:28]</a>, <a class="yt-timestamp" data-t="00:01:32">[00:01:32]</a>.

## The [[Transformers and attention in language models | Attention Mechanism]]
The [[Transformers and attention in language models | attention mechanism]] is a critical component within a [[Neural Networks and Transformers | transformer]] <a class="yt-timestamp" data-t="00:01:40">[00:01:40]</a>. It allows information encoded in one embedding to be moved to another, even if they are far apart in the text <a class="yt-timestamp" data-t="00:03:32">[00:03:32]</a>. This is crucial for refining word meanings based on context, such as distinguishing between different meanings of "mole" based on surrounding words <a class="yt-timestamp" data-t="00:02:06">[00:02:06]</a>, <a class="yt-timestamp" data-t="00:02:09">[00:02:09]</a>.

### Single Head of Attention
A single head of attention processes information using three distinct matrices filled with tuneable weights:
1.  **Query (WQ) matrix**: Multiplied by each embedding to produce a "query" vector <a class="yt-timestamp" data-t="00:06:42">[00:06:42]</a>, <a class="yt-timestamp" data-t="00:06:46">[00:06:46]</a>. This vector encodes what information the current word is "looking for" in other words <a class="yt-timestamp" data-t="00:06:32">[00:06:32]</a>.
2.  **Key (WK) matrix**: Multiplied by each embedding to produce a "key" vector <a class="yt-timestamp" data-t="00:07:47">[00:07:47]</a>, <a class="yt-timestamp" data-t="00:07:51">[00:07:51]</a>. Key vectors conceptually "answer" queries <a class="yt-timestamp" data-t="00:07:59">[00:07:59]</a>.
    *   Both query and key matrices map the high-dimensional embeddings (e.g., 12,288 dimensions in GPT-3 <a class="yt-timestamp" data-t="00:16:09">[00:16:09]</a>) down to a smaller dimensional space (e.g., 128 dimensions in GPT-3 <a class="yt-timestamp" data-t="00:06:36">[00:06:36]</a>, <a class="yt-timestamp" data-t="00:16:15">[00:16:15]</a>). Each of these matrices for GPT-3 has approximately 1.5 million parameters <a class="yt-timestamp" data-t="00:16:20">[00:16:20]</a>, <a class="yt-timestamp" data-t="00:16:24">[00:16:24]</a>.
3.  **Value (WV) matrix**: Multiplied by each embedding to produce a "value" vector <a class="yt-timestamp" data-t="00:13:44">[00:13:44]</a>, <a class="yt-timestamp" data-t="00:13:53">[00:13:53]</a>. Value vectors represent what should be added to an embedding if another word finds it relevant <a class="yt-timestamp" data-t="00:14:10">[00:14:10]</a>.
    *   The value matrix outputs vectors in the original high-dimensional embedding space (e.g., 12,288 dimensions) <a class="yt-timestamp" data-t="00:14:02">[00:14:02]</a>.
    *   In practice, to improve efficiency, the value map is typically factored into two smaller matrices: a "value down" matrix (mapping to the smaller key/query space) and a "value up" matrix (mapping back to the embedding space) <a class="yt-timestamp" data-t="00:17:06">[00:17:06]</a>, <a class="yt-timestamp" data-t="00:17:27">[00:17:27]</a>, <a class="yt-timestamp" data-t="00:17:43">[00:17:43]</a>.
    *   A single attention head (with these four matrices) has approximately 6.3 million parameters <a class="yt-timestamp" data-t="00:18:11">[00:18:11]</a>, <a class="yt-timestamp" data-t="00:18:16">[00:18:16]</a>.

#### Attention Pattern Computation
*   **Dot Products**: Dot products are computed between all possible key-query pairs, indicating how well each key matches each query <a class="yt-timestamp" data-t="00:08:27">[00:08:27]</a>, <a class="yt-timestamp" data-t="00:08:30">[00:08:30]</a>.
*   **Masking**: During [[Training process of language models | training]], to prevent later words from influencing earlier ones (which would "give away" answers), entries representing later tokens influencing earlier ones are set to negative infinity before softmax, effectively turning them to zero after normalization <a class="yt-timestamp" data-t="00:11:49">[00:11:49]</a>, <a class="yt-timestamp" data-t="00:12:13">[00:12:13]</a>, <a class="yt-timestamp" data-t="00:12:19">[00:12:19]</a>. This ensures columns remain normalized (add up to 1) <a class="yt-timestamp" data-t="00:12:11">[00:12:11]</a>.
*   **Softmax**: The dot products are then normalized using a softmax function column-wise to produce an "attention pattern," where values range between 0 and 1 and each column sums to 1 <a class="yt-timestamp" data-t="00:09:40">[00:09:40]</a>, <a class="yt-timestamp" data-t="00:09:52">[00:09:52]</a>, <a class="yt-timestamp" data-t="00:10:00">[00:10:00]</a>. This pattern indicates the relevance of each word to updating every other word's meaning <a class="yt-timestamp" data-t="00:09:21">[00:09:21]</a>.
*   **Context Size**: The size of the attention pattern is equal to the square of the context size, making context size a significant bottleneck for LLMs <a class="yt-timestamp" data-t="00:12:45">[00:12:45]</a>, <a class="yt-timestamp" data-t="00:12:49">[00:12:49]</a>.

#### Updating Embeddings
To update an embedding, each value vector is multiplied by its corresponding weight from the attention pattern <a class="yt-timestamp" data-t="00:14:42">[00:14:42]</a>, <a class="yt-timestamp" data-t="00:14:45">[00:14:45]</a>. These rescaled value vectors are then summed to produce a "change" vector (delta-e), which is added to the original embedding, resulting in a more contextually rich embedding <a class="yt-timestamp" data-t="00:15:06">[00:15:06]</a>, <a class="yt-timestamp" data-t="00:15:13">[00:15:13]</a>, <a class="yt-timestamp" data-t="00:15:16">[00:15:16]</a>.

### Multi-Headed Attention
A full attention block within a [[Neural Networks and Transformers | transformer]] consists of "multi-headed attention," where many single attention heads run in parallel <a class="yt-timestamp" data-t="00:20:35">[00:20:35]</a>, <a class="yt-timestamp" data-t="00:20:38">[00:20:38]</a>. Each head has its own distinct key, query, and value maps, allowing the model to learn multiple ways context can influence meaning <a class="yt-timestamp" data-t="00:20:05">[00:20:05]</a>, <a class="yt-timestamp" data-t="00:20:08">[00:20:08]</a>, <a class="yt-timestamp" data-t="00:20:11">[00:20:11]</a>.

For example, [[Generative Pretrained Transformers | GPT-3]] utilizes 96 attention heads within each block <a class="yt-timestamp" data-t="00:20:47">[00:20:47]</a>. Each head produces a proposed change to an embedding, and these changes are summed together and added to the original embedding to produce the refined output embedding for that position <a class="yt-timestamp" data-t="00:21:17">[00:21:17]</a>, <a class="yt-timestamp" data-t="00:21:27">[00:21:27]</a>, <a class="yt-timestamp" data-t="00:21:32">[00:21:32]</a>.

## Parameter Counts in [[Generative Pretrained Transformers | GPT-3]]
*   **Per Multi-Headed Attention Block**: With 96 heads, each containing its own four matrices (query, key, value-down, value-up), one block of multi-headed attention has approximately 600 million parameters <a class="yt-timestamp" data-t="00:22:03">[00:22:03]</a>, <a class="yt-timestamp" data-t="00:22:07">[00:22:07]</a>, <a class="yt-timestamp" data-t="00:22:10">[00:22:10]</a>.
*   **Total Attention Parameters**: [[Generative Pretrained Transformers | GPT-3]] includes 96 distinct layers (or blocks) <a class="yt-timestamp" data-t="00:24:16">[00:24:16]</a>, <a class="yt-timestamp" data-t="00:24:21">[00:24:21]</a>. This multiplies the total key, query, and value parameters by 96, bringing the sum to just under 58 billion parameters devoted to all attention heads <a class="yt-timestamp" data-t="00:24:27">[00:24:27]</a>, <a class="yt-timestamp" data-t="00:24:31">[00:24:31]</a>.
*   **Overall Parameters**: While substantial, these 58 billion parameters account for only about one-third of [[Generative Pretrained Transformers | GPT-3]]'s total of 175 billion parameters <a class="yt-timestamp" data-t="00:24:34">[00:24:34]</a>, <a class="yt-timestamp" data-t="00:24:37">[00:24:37]</a>, <a class="yt-timestamp" data-t="00:24:41">[00:24:41]</a>. The majority of parameters come from other blocks within the [[Structure of neural networks | network]], such as multi-layer perceptrons, which are interspersed between attention blocks <a class="yt-timestamp" data-t="00:23:28">[00:23:28]</a>, <a class="yt-timestamp" data-t="00:24:44">[00:24:44]</a>.

## [[Computation and infrastructure for training language models | Parallelizability]]
A key factor in the success of the [[Transformers and attention in language models | attention mechanism]] is its extreme [[Computation and infrastructure for training language models | parallelizability]], allowing a huge number of computations to run quickly using GPUs <a class="yt-timestamp" data-t="00:24:58">[00:24:58]</a>, <a class="yt-timestamp" data-t="00:25:02">[00:25:02]</a>. This parallel processing capability supports scaling up models, which has led to significant qualitative improvements in performance over the last two decades <a class="yt-timestamp" data-t="00:25:09">[00:25:09]</a>, <a class="yt-timestamp" data-t="00:25:13">[00:25:13]</a>.