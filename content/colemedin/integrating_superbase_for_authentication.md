---
title: Integrating Superbase for Authentication
videoId: JyolNYRbAcs
---

From: [[colemedin]] <br/> 

Building [[Using Supabase for AI agents | AI agents]] with n8n is popular due to its ease of use for creating simple yet powerful agents without code <a class="yt-timestamp" data-t="00:00:00">[00:00:00]</a>. However, [[Using Supabase for AI agents | AI agents]] often require a clean front end for user interaction beyond n8n's basic chat widget <a class="yt-timestamp" data-t="00:00:19">[00:00:19]</a>. This article details a secure and efficient way to create and deploy interfaces for [[Using Supabase for AI agents | AI agents]] using Streamlit, Claude (for code generation), and [[Superbase authentication integration in AI apps | Supabase for authentication]] <a class="yt-timestamp" data-t="00:00:36">[00:00:36]</a>. This approach avoids the need for full React or Next.js projects and extensive manual coding <a class="yt-timestamp" data-t="00:00:47">[00:00:47]</a>.

## Why the Streamlit, Claude, and [[Integrating n8n and Supabase | Supabase]] Combo?

*   **Streamlit**: A Python package that simplifies website building, eliminating the need for JavaScript <a class="yt-timestamp" data-t="00:01:18">[00:01:18]</a>.
*   **Claude**: An LLM (Large Language Model) that is exceptionally good at coding with Streamlit <a class="yt-timestamp" data-t="00:01:25">[00:01:25]</a>.
*   **[[Integrating n8n and Supabase | Supabase]]**: Integrates easily for authentication and is often already used for [[Using Postgres and Superbase for AI chat memory | AI chat memory]] and RAG (Retrieval Augmented Generation) in [[Using Supabase for AI agents | AI agents]] <a class="yt-timestamp" data-t="00:01:37">[00:01:37]</a>.

## Building a Basic Streamlit Interface (Without [[Superbase authentication integration in AI apps | Supabase Authentication]])

The initial step involves using Claude to generate a basic Streamlit chat interface that interacts with an LLM via a webhook <a class="yt-timestamp" data-t="00:01:47">[00:01:47]</a>.

### Initial Claude Prompt and Code
A prompt is given to Claude to create a Streamlit application with a chat interface to talk to an LLM <a class="yt-timestamp" data-t="00:02:33">[00:02:33]</a>. The prompt specifies:
*   How to chat with the LLM.
*   How to use the webhook (POST request).
*   Required payload items: `session ID` (for chat history) and `chat input` (user prompt) <a class="yt-timestamp" data-t="00:03:10">[00:03:10]</a>.
*   Expected JSON response structure, specifically an `output` key containing the LLM's response <a class="yt-timestamp" data-t="00:03:33">[00:03:33]</a>.

For initial, *non-production* testing, a basic hardcoded bearer token is used for protection, preventing unauthorized access to the n8n workflow and LLM credits <a class="yt-timestamp" data-t="00:02:49">[00:02:49]</a>.

### n8n Workflow Configuration for Front End Integration
To make the n8n agent accessible to a front end via a webhook:
1.  **Add a Webhook Trigger**: This node initiates the workflow when an API request is received <a class="yt-timestamp" data-t="00:05:32">[00:05:32]</a>.
2.  **Add a "Respond to Webhook" Node**: Placed at the very end of the workflow, this node returns the output (e.g., from the LLM) back to the originating API call <a class="yt-timestamp" data-t="00:05:38">[00:05:38]</a>.
3.  **Webhook Authentication (Temporary)**: Initially, set up header authentication with an `Authorization` header and a `Bearer` token (e.g., `Bearer YOUR_TOKEN_NAME`) <a class="yt-timestamp" data-t="00:06:14">[00:06:14]</a>. This is replaced by [[Superbase authentication integration in AI apps | Supabase authentication]] later <a class="yt-timestamp" data-t="00:06:18">[00:06:18]</a>.
4.  **Payload Handling**: The n8n workflow is configured to accept `session ID` and `chat input` from either the chat widget or the webhook payload <a class="yt-timestamp" data-t="00:07:31">[00:07:31]</a>.

## Adding [[Superbase authentication integration in AI apps | Supabase Authentication]]

This section focuses on enhancing the Streamlit app to include robust [[Superbase authentication integration in AI apps | Supabase authentication]].

### Updating the Claude Prompt
The prompt to Claude is updated to:
*   Use [[Superbase authentication integration in AI apps | Supabase for authentication]] <a class="yt-timestamp" data-t="00:11:07">[00:11:07]</a>.
*   Include both login and signup tabs <a class="yt-timestamp" data-t="00:11:11">[00:11:11]</a>.
*   Use the user's [[Supabase features like authentication and object storage | Supabase]] token as the bearer token for the webhook request to n8n <a class="yt-timestamp" data-t="00:11:19">[00:11:19]</a>. This token is dynamically generated by the [[Supabase features like authentication and object storage | Supabase]] Python library after a successful login <a class="yt-timestamp" data-t="00:11:28">[00:11:28]</a>.
*   Display user information, such as email, in the Streamlit UI <a class="yt-timestamp" data-t="00:11:57">[00:11:57]</a>.
*   Explicitly tell Claude to avoid deprecated or experimental features to prevent hallucinations <a class="yt-timestamp" data-t="00:12:04">[00:12:04]</a>.

### n8n Workflow Changes for [[Superbase authentication integration in AI apps | Supabase Authentication]]
1.  **Disable Webhook Authentication**: The authentication setting on the Webhook Trigger node in n8n must be turned off, as authentication will now be handled manually within the workflow <a class="yt-timestamp" data-t="00:13:30">[00:13:30]</a>.
2.  **Retrieve [[Supabase features like authentication and object storage | Supabase]] API Keys**:
    *   **Project URL**: Found in [[Supabase features like authentication and object storage | Supabase]] Project Settings > API <a class="yt-timestamp" data-t="00:13:50">[00:13:50]</a>.
    *   **Service Role Secret**: This is the private API key, *not* to be shared publicly <a class="yt-timestamp" data-t="00:14:10">[00:14:10]</a>.
    *   **Anonymous API Key**: This is the public API key, safe to use in client-side code *if* row-level security is properly defined <a class="yt-timestamp" data-t="00:14:19">[00:14:19]</a>.
3.  **HTTP Request Node for Verification**:
    *   Add an HTTP Request node to verify the user's [[Supabase features like authentication and object storage | Supabase]] bearer token <a class="yt-timestamp" data-t="00:14:40">[00:14:40]</a>.
    *   **Method**: `GET` <a class="yt-timestamp" data-t="00:15:19">[00:15:19]</a>.
    *   **URL**: `[YOUR_SUPABASE_PROJECT_URL]/auth/v1/user` <a class="yt-timestamp" data-t="00:15:16">[00:15:16]</a>.
    *   **Headers**:
        *   `apiKey`: Set to your **Service Role Secret** (private key) <a class="yt-timestamp" data-t="00:14:45">[00:14:45]</a>.
        *   `Authorization`: Set to the `Authorization` header received from the incoming webhook request (`json.heads.authorization`) <a class="yt-timestamp" data-t="00:15:01">[00:15:01]</a>.
4.  **Conditional Authentication Check**: Use an `If` statement node to check the response from the HTTP request. If a valid user object is returned, it will contain an `email` attribute. The presence of this attribute indicates successful authentication <a class="yt-timestamp" data-t="00:15:41">[00:15:41]</a>.
    *   If authentication is successful, the workflow continues to process the AI agent's logic.
    *   If not, an error can be returned <a class="yt-timestamp" data-t="00:15:58">[00:15:58]</a>.
5.  **Security Note**: While pasting the [[Supabase features like authentication and object storage | Supabase]] API key directly is simple, for higher security, consider using a secrets manager service like AWS Secrets Manager to store and fetch the key <a class="yt-timestamp" data-t="00:16:15">[00:16:15]</a>.

## Streamlit Code Implementation and Testing
After generating the updated code from Claude, replace the existing Streamlit script. Fill in the placeholders for the [[Supabase features like authentication and object storage | Supabase]] URL and Anonymous authentication key (public key) <a class="yt-timestamp" data-t="00:17:21">[00:17:21]</a>. The webhook URL remains the same if the n8n workflow was edited in place <a class="yt-timestamp" data-t="00:17:31">[00:17:31]</a>.

*   **Running the App**: Execute `streamlit run your_script_name.py` in the terminal <a class="yt-timestamp" data-t="00:09:54">[00:09:54]</a>.
*   **Iterative Process**: Claude may occasionally "hallucinate" or suggest deprecated features (e.g., `experimental.rerun`) <a class="yt-timestamp" data-t="00:18:33">[00:18:33]</a>. It's an iterative process, but Claude is generally good at correcting itself when prompted <a class="yt-timestamp" data-t="00:18:40">[00:18:40]</a>.
*   **Testing**: After successful login with valid [[Supabase features like authentication and object storage | Supabase]] credentials, the interface displays the user's email and session ID, and the [[Using Supabase for AI agents | AI agent]] functions as expected with [[Superbase authentication integration in AI apps | Supabase authentication]] happening behind the scenes <a class="yt-timestamp" data-t="00:19:27">[00:19:27]</a>.

This setup provides a robust and secure foundation for building interactive front ends for your [[Using Supabase for AI agents | n8n AI agents]] <a class="yt-timestamp" data-t="00:20:05">[00:20:05]</a>.